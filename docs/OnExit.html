<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OnExit | AutoHotkey v2 Documentation</title>
    <meta name="description" content="Registers a [function](../Functions.htm) to be called automatically">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="/AHKv2_Docs/css/styles.css">
    <link rel="stylesheet" href="/AHKv2_Docs/css/sidebar.css">
    <link rel="stylesheet" href="/AHKv2_Docs/css/markdown.css">
    <link rel="stylesheet" href="/AHKv2_Docs/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-left">
                <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
                    <i class="fas fa-bars"></i>
                </button>
                <a href="/AHKv2_Docs/" class="navbar-brand">
                    <span class="logo-icon">âš¡</span>
                    <span class="logo-text">AutoHotkey v2</span>
                </a>
            </div>
            <div class="navbar-center">
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="searchInput" placeholder="Search documentation..." autocomplete="off">
                    <kbd class="search-hint">Ctrl+K</kbd>
                </div>
            </div>
            <div class="navbar-right">
                <a href="https://github.com/012090120901209/AHKv2_Docs" class="nav-link" target="_blank" rel="noopener">
                    <i class="fab fa-github"></i>
                    <span>GitHub</span>
                </a>
                <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Search Results Dropdown -->
    <div class="search-results" id="searchResults" style="display: none;"></div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-content">
                <!-- Category Navigation -->
                <div class="sidebar-section">
                    <div class="sidebar-category">
                        <div class="category-header">
                            <i class="fas fa-book"></i>
                            <span>Getting Started</span>
                        </div>
                        <ul class="category-items">
                            <li><a href="/AHKv2_Docs/Tutorial.html">Tutorial</a></li>
                            <li><a href="/AHKv2_Docs/FAQ.html">FAQ</a></li>
                            <li><a href="/AHKv2_Docs/Concepts.html">Concepts</a></li>
                        </ul>
                    </div>

                    <div class="sidebar-category">
                        <div class="category-header">
                            <i class="fas fa-code"></i>
                            <span>Functions</span>
                        </div>
                        <ul class="category-items">
                            <li><a href="/AHKv2_Docs/Functions.html">Functions</a></li>
                            <li><a href="/AHKv2_Docs/StrLen.html">String Functions</a></li>
                            <li><a href="/AHKv2_Docs/WinActivate.html">Window Functions</a></li>
                            <li><a href="/AHKv2_Docs/FileRead.html">File Operations</a></li>
                        </ul>
                    </div>

                    <div class="sidebar-category">
                        <div class="category-header">
                            <i class="fas fa-cube"></i>
                            <span>Objects</span>
                        </div>
                        <ul class="category-items">
                            <li><a href="/AHKv2_Docs/Array.html">Array</a></li>
                            <li><a href="/AHKv2_Docs/Map.html">Map</a></li>
                            <li><a href="/AHKv2_Docs/Object.html">Object</a></li>
                            <li><a href="/AHKv2_Docs/Gui.html">Gui</a></li>
                        </ul>
                    </div>

                    <div class="sidebar-category">
                        <div class="category-header">
                            <i class="fas fa-hashtag"></i>
                            <span>Directives</span>
                        </div>
                        <ul class="category-items">
                            <li><a href="/AHKv2_Docs/_Include.html">#Include</a></li>
                            <li><a href="/AHKv2_Docs/_Requires.html">#Requires</a></li>
                            <li><a href="/AHKv2_Docs/_HotIf.html">#HotIf</a></li>
                        </ul>
                    </div>

                    <div class="sidebar-category">
                        <div class="category-header">
                            <i class="fas fa-info-circle"></i>
                            <span>Reference</span>
                        </div>
                        <ul class="category-items">
                            <li><a href="/AHKv2_Docs/KeyList.html">Key List</a></li>
                            <li><a href="/AHKv2_Docs/Hotkeys.html">Hotkeys</a></li>
                            <li><a href="/AHKv2_Docs/Variables.html">Variables</a></li>
                            <li><a href="/AHKv2_Docs/Language.html">Language</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="content">
            <div class="content-wrapper">
                <!-- Breadcrumb -->
                <nav class="breadcrumb" aria-label="Breadcrumb">
                    <a href="/AHKv2_Docs/">Home</a> <i class="fas fa-chevron-right"></i> <span>OnExit</span>
                </nav>

                <!-- Document Content -->
                <article class="markdown-body">
                    <h1 id="onexit">OnExit</h1>
<p>Registers a <a href="../Functions.htm">function</a> to be called automatically
whenever the script exits.</p>
<pre class="codehilite"><code class="language-Syntax">OnExit Callback , AddRemove
</code></pre>

<h2 id="Parameters">Parameters</h2>
<dl>
<dt>Callback</dt>
<dd>
<p>Type: <a href="../misc/Functor.htm">Function Object</a></p>
<p>The function to call.</p>
<p>The callback accepts two parameters and can be
<a href="../Functions.htm#intro">defined</a> as follows:</p>
<p><code>NoIndent
MyCallback(ExitReason, ExitCode) { ...</code></p>
<p>Although the names you give the parameters do not matter, the
following values are sequentially assigned to them:</p>
<ol>
<li>The exit reason (one of the words from the <a href="#ExitReason">table
    below</a>).</li>
<li>The exit code passed to <a href="Exit.htm">Exit</a> or
    <a href="ExitApp.htm">ExitApp</a>.</li>
</ol>
<p>You can omit one or more parameters from the end of the callback\'s
parameter list if the corresponding information is not needed, but
in this case an asterisk must be specified as the final parameter,
e.g. <code>MyCallback(Param1, *)</code>.</p>
<p>The callback can return a non-zero integer to prevent the script
from exiting (with some <a href="#close">rare exceptions</a>) and calling more
callbacks. Otherwise, the script exits after all registered
callbacks are called.</p>
</dd>
<dt>AddRemove</dt>
<dd>
<p>Type: <a href="../Concepts.htm#numbers">Integer</a></p>
<p>If omitted, it defaults to 1. Otherwise, specify one of the
following numbers:</p>
<ul>
<li>1 = Call the callback after any previously registered callbacks.</li>
<li>-1 = Call the callback before any previously registered
    callbacks.</li>
<li>0 = Do not call the callback.</li>
</ul>
</dd>
</dl>
<h2 id="Remarks">Remarks</h2>
<p>Any number of callbacks can be registered. A callback usually should not
call ExitApp; if it does, the script terminates immediately.</p>
<p>The callbacks are called when the script exits by any means (except when
it is killed by something like \"End Task\"). It is also called whenever
<a href="_SingleInstance.htm">#SingleInstance</a> and <a href="Reload.htm">Reload</a> ask a
previous instance to terminate.</p>
<p>A script can detect and optionally abort a system shutdown or logoff via
<code>OnMessage(0x0011, On_WM_QUERYENDSESSION)</code> (see [OnMessage example</p>
<h1 id="2onmessagehtmexshutdown-for-a-working-script">2](OnMessage.htm#ExShutdown) for a working script).</h1>
<p>The OnExit <a href="../misc/Threads.htm">thread</a> does not obey
<a href="_MaxThreads.htm">#MaxThreads</a> (it will always launch when needed). In
addition, while it is running, it cannot be interrupted by any
<a href="../misc/Threads.htm">thread</a>, including <a href="../Hotkeys.htm">hotkeys</a>,
<a href="Menu.htm">custom menu items</a>, and <a href="SetTimer.htm">timed subroutines</a>.
However, it will be interrupted (and the script will terminate) if the
user chooses Exit from the tray menu or main menu, or the script is
asked to terminate as a result of <a href="Reload.htm">Reload</a> or
<a href="_SingleInstance.htm">#SingleInstance</a>. Because of this, a callback
should be designed to finish quickly unless the user is aware of what it
is doing.</p>
<p>If the OnExit <a href="../misc/Threads.htm">thread</a> encounters a failure
condition such as a runtime error, the script will terminate.</p>
<p>If the OnExit <a href="../misc/Threads.htm">thread</a> was launched due to
<a href="Exit.htm">Exit</a> or <a href="ExitApp.htm">ExitApp</a> that specified an exit code,
that exit code is used unless a callback returns 1 (true) to prevent
exit or calls ExitApp.</p>
<p>Whenever an exit attempt is made, each callback starts off fresh with
the default values for settings such as <a href="SendMode.htm">SendMode</a>. These
defaults can be changed during <a href="../Scripts.htm#auto">script startup</a>.</p>
<h2 id="ExitReason">Exit Reasons</h2>
<table>
<thead>
<tr>
<th colspan="1" rowspan="1">
<p>Reason</p>
</th>
<th colspan="1" rowspan="1">
<p>Description</p>
</th>
</tr>
</thead>
<tbody>
<tr>
<td colspan="1" rowspan="1">
<p>Logoff</p>
</td>
<td colspan="1" rowspan="1">
<p>The user is logging off.</p>
</td>
</tr>
<tr>
<td colspan="1" rowspan="1">
<p>Shutdown<br />
<br />
<br />
</p>
</td>
<td colspan="1" rowspan="1">
<p>The system is being shut down or<br />
restarted, such as by the<br />
<a href="Shutdown.htm">Shutdown</a><br />
function.</p>
</td>
</tr>
<tr>
<td colspan="1" rowspan="1">
<p>Close<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
</p>
</td>
<td colspan="1" rowspan="1">
<p>The script was sent a WM_CLOSE or<br />
WM_QUIT message, had a critical<br />
error, or is being closed in some<br />
other way. Although all of these<br />
are unusual, WM_CLOSE might be<br />
caused by<br />
<a href="WinClose.htm">WinClose</a> having<br />
been used on the script\'s main<br />
window. To close (hide) the<br />
window without terminating the<br />
script, use<br />
<a href="WinHide.htm">WinHide</a>.<br />
<br />
If the script is exiting due to a<br />
critical error or its <a href="../Program.htm#main-window">main<br />
wi<br />
ndow</a><br />
being destroyed, it will<br />
unconditionally terminate after<br />
the OnExit thread completes.<br />
<br />
If the main window is being<br />
destroyed, it may still exist but<br />
cannot be displayed. This<br />
condition can be detected by<br />
monitoring the WM_DESTROY message<br />
with <a href="OnMessage.htm">OnMessage</a>.</p>
</td>
</tr>
<tr>
<td colspan="1" rowspan="1">
<p>Error<br />
<br />
<br />
<br />
<br />
<br />
<br />
</p>
</td>
<td colspan="1" rowspan="1">
<p>A runtime error occurred in a<br />
script that is not<br />
<a href="../Scripts.htm#persistent">persis<br />
tent</a>.<br />
An example of a runtime error is<br />
<a href="Run.htm">Run/RunWait</a> being<br />
unable to launch the specified<br />
program or document.</p>
</td>
</tr>
<tr>
<td colspan="1" rowspan="1">
<p>Menu<br />
<br />
<br />
<br />
<br />
</p>
</td>
<td colspan="1" rowspan="1">
<p>The user selected Exit from the<br />
<a href="../Program.htm#main-window">main<br />
windo<br />
w</a>\'s<br />
menu or from the <a href="../Program.htm#tray-icon">standard tray<br />
menu</a>.</p>
</td>
</tr>
<tr>
<td colspan="1" rowspan="1">
<p>Exit<br />
<br />
<br />
</p>
</td>
<td colspan="1" rowspan="1">
<p><a href="Exit.htm">Exit</a> or<br />
<a href="ExitApp.htm">ExitApp</a> was used<br />
(includes <a href="Menu.htm">custom menu<br />
items</a>).</p>
</td>
</tr>
<tr>
<td colspan="1" rowspan="1">
<p>Reload<br />
<br />
</p>
</td>
<td colspan="1" rowspan="1">
<p>The script is being reloaded via<br />
the <a href="Reload.htm">Reload</a> function<br />
or menu item.</p>
</td>
</tr>
<tr>
<td colspan="1" rowspan="1">
<p>Single<br />
<br />
<br />
<br />
</p>
</td>
<td colspan="1" rowspan="1">
<p>The script is being replaced by a<br />
new instance of itself as a<br />
result of<br />
<a href="_SingleInstance.htm">#Sing<br />
leInstance</a>.</p>
</td>
</tr>
</tbody>
</table>
<h2 id="Related">Related</h2>
<p><a href="OnError.htm">OnError</a>, <a href="OnMessage.htm">OnMessage</a>,
<a href="CallbackCreate.htm">CallbackCreate</a>,
<a href="OnClipboardChange.htm">OnClipboardChange</a>, <a href="ExitApp.htm">ExitApp</a>,
<a href="Shutdown.htm">Shutdown</a>, <a href="Persistent.htm">Persistent</a>,
<a href="../misc/Threads.htm">Threads</a>, <a href="Return.htm">Return</a></p>
<h2 id="Examples">Examples</h2>
<p>::: {#ExBasic .ex}
<a class="ex_number" href="#ExBasic"></a> Asks the user before exiting the script. To
test this example, right-click the <a href="../Program.htm#tray-icon">tray icon</a>
and click Exit.</p>
<pre class="codehilite"><code class="language-NoIndent">Persistent  ; Prevent the script from exiting automatically.
OnExit ExitFunc

ExitFunc(ExitReason, ExitCode)
{
    if ExitReason != &quot;Logoff&quot; and ExitReason != &quot;Shutdown&quot;
    {
        Result := MsgBox(&quot;Are you sure you want to exit?&quot;,, 4)
        if Result = &quot;No&quot;
            return 1  ; Callbacks must return non-zero to avoid exit.
    }
    ; Do not call ExitApp -- that would prevent other callbacks from being called.
}
</code></pre>

<p>:::</p>
<p>::: {#ExFnObj .ex}
<a class="ex_number" href="#ExFnObj"></a> Registers a method to be called on exit.</p>
<pre class="codehilite"><code>Persistent  ; Prevent the script from exiting automatically.
OnExit MyObject.Exiting

class MyObject
{
    static Exiting(*)
    {
        MsgBox &quot;MyObject is cleaning up prior to exiting...&quot;
        /*
        this.SayGoodbye()
        this.CloseNetworkConnections()
        */
    }
}
</code></pre>

<p>:::</p>
                </article>

                <!-- Footer Navigation -->
                <div class="doc-pagination">
                    
                    
                </div>

                <!-- Edit on GitHub -->
                <div class="edit-page">
                    <a href="https://github.com/012090120901209/AHKv2_Docs/edit/main/OnExit.md" target="_blank" rel="noopener">
                        <i class="fas fa-edit"></i> Edit this page
                    </a>
                </div>
            </div>

            <!-- Table of Contents -->
            <aside class="toc">
                <div class="toc-wrapper">
                    <h3 class="toc-title">On this page</h3>
                    <nav id="tableOfContents">
                        <div class="toc">
<ul>
<li><a href="#onexit">OnExit</a><ul>
<li><a href="#Parameters">Parameters</a></li>
<li><a href="#Remarks">Remarks</a></li>
</ul>
</li>
<li><a href="#2onmessagehtmexshutdown-for-a-working-script">2](OnMessage.htm#ExShutdown) for a working script).</a><ul>
<li><a href="#ExitReason">Exit Reasons</a></li>
<li><a href="#Related">Related</a></li>
<li><a href="#Examples">Examples</a></li>
</ul>
</li>
</ul>
</div>

                    </nav>
                </div>
            </aside>
        </main>
    </div>

    <!-- Scripts -->
    <script>
        // Set base URL for JavaScript modules
        window.BASE_URL = '/AHKv2_Docs';
    </script>
    <script src="/AHKv2_Docs/js/theme.js"></script>
    <script src="/AHKv2_Docs/js/sidebar.js"></script>
    <script src="/AHKv2_Docs/js/search.js"></script>
    <script src="/AHKv2_Docs/js/toc.js"></script>
    <script src="/AHKv2_Docs/js/syntax.js"></script>
</body>
</html>