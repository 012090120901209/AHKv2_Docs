<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binary Compatibility | AutoHotkey v2 Documentation</title>
    <meta name="description" content="This document contains some topics which are sometimes important when">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/sidebar.css">
    <link rel="stylesheet" href="/css/markdown.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-left">
                <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
                    <i class="fas fa-bars"></i>
                </button>
                <a href="/" class="navbar-brand">
                    <span class="logo-icon">âš¡</span>
                    <span class="logo-text">AutoHotkey v2</span>
                </a>
            </div>
            <div class="navbar-center">
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="searchInput" placeholder="Search documentation..." autocomplete="off">
                    <kbd class="search-hint">Ctrl+K</kbd>
                </div>
            </div>
            <div class="navbar-right">
                <a href="https://github.com/012090120901209/AHKv2_Docs" class="nav-link" target="_blank" rel="noopener">
                    <i class="fab fa-github"></i>
                    <span>GitHub</span>
                </a>
                <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Search Results Dropdown -->
    <div class="search-results" id="searchResults" style="display: none;"></div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-content">
                <!-- Category Navigation -->
                <div class="sidebar-section">
                    <div class="sidebar-category">
                        <div class="category-header">
                            <i class="fas fa-book"></i>
                            <span>Getting Started</span>
                        </div>
                        <ul class="category-items">
                            <li><a href="/guides/Tutorial.html">Tutorial</a></li>
                            <li><a href="/guides/FAQ.html">FAQ</a></li>
                            <li><a href="/guides/Concepts.html">Concepts</a></li>
                        </ul>
                    </div>

                    <div class="sidebar-category">
                        <div class="category-header">
                            <i class="fas fa-code"></i>
                            <span>Functions</span>
                        </div>
                        <ul class="category-items">
                            <li><a href="/functions/string/">String Functions</a></li>
                            <li><a href="/functions/window/">Window Functions</a></li>
                            <li><a href="/functions/file/">File Operations</a></li>
                            <li><a href="/functions/system/">System Functions</a></li>
                        </ul>
                    </div>

                    <div class="sidebar-category">
                        <div class="category-header">
                            <i class="fas fa-cube"></i>
                            <span>Objects</span>
                        </div>
                        <ul class="category-items">
                            <li><a href="/objects/Array.html">Array</a></li>
                            <li><a href="/objects/Map.html">Map</a></li>
                            <li><a href="/objects/Object.html">Object</a></li>
                            <li><a href="/objects/Gui.html">Gui</a></li>
                        </ul>
                    </div>

                    <div class="sidebar-category">
                        <div class="category-header">
                            <i class="fas fa-hashtag"></i>
                            <span>Directives</span>
                        </div>
                        <ul class="category-items">
                            <li><a href="/directives/_Include.html">#Include</a></li>
                            <li><a href="/directives/_Requires.html">#Requires</a></li>
                            <li><a href="/directives/_HotIf.html">#HotIf</a></li>
                        </ul>
                    </div>

                    <div class="sidebar-category">
                        <div class="category-header">
                            <i class="fas fa-info-circle"></i>
                            <span>Reference</span>
                        </div>
                        <ul class="category-items">
                            <li><a href="/reference/KeyList.html">Key List</a></li>
                            <li><a href="/reference/Hotkeys.html">Hotkeys</a></li>
                            <li><a href="/reference/Variables.html">Variables</a></li>
                            <li><a href="/reference/Language.html">Language</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="content">
            <div class="content-wrapper">
                <!-- Breadcrumb -->
                <nav class="breadcrumb" aria-label="Breadcrumb">
                    <a href="/">Home</a> <i class="fas fa-chevron-right"></i> <span>Compat</span>
                </nav>

                <!-- Document Content -->
                <article class="markdown-body">
                    <h1 id="binary-compatibility">Binary Compatibility</h1>
<p>This document contains some topics which are sometimes important when
dealing with external libraries or sending messages to a control or
window.</p>
<ul>
<li><a href="#Format">Unicode vs ANSI</a><ul>
<li><a href="#Buffer">Buffer</a></li>
<li><a href="#DllCall">DllCall</a></li>
<li><a href="#NumPutGet">NumPut / NumGet</a></li>
</ul>
</li>
<li><a href="#ptr">Pointer Size</a></li>
</ul>
<h2 id="Format">Unicode vs ANSI</h2>
<p><strong>Note:</strong> This section builds on topics covered in other parts of the
documentation: <a href="Concepts.htm#strings">Strings</a>, <a href="Concepts.htm#string-encoding">String
Encoding</a>.</p>
<p>Within a string (text value), the numeric character code and size (in
bytes) of each character depends on the
<a href="Concepts.htm#string-encoding">encoding</a> of the string. These details
are typically important for scripts which do any of the following:</p>
<ul>
<li>Pass strings to external functions via <a href="#DllCall">DllCall</a>.</li>
<li>Pass strings via <a href="lib/PostMessage.htm">PostMessage</a> or
    <a href="lib/SendMessage.htm">SendMessage</a>.</li>
<li>Manipulate strings directly via <a href="#NumPutGet">NumPut/NumGet</a>.</li>
<li>Allocate a <a href="#Buffer">Buffer</a> to hold a specific number of
    characters.</li>
</ul>
<p>AutoHotkey v2 natively uses Unicode (UTF-16), but some external
libraries or window messages might require ANSI strings.</p>
<p><strong>ANSI:</strong> Each character is <strong>one byte</strong> (8 bits). Character codes above
127 depend on your system\'s language settings (or the codepage chosen
when the text was encoded, such as when it is written to a file).</p>
<p><strong>Unicode:</strong> Each character is <strong>two bytes</strong> (16 bits). Character codes
are as defined by the <a href="https://en.wikipedia.org/wiki/UTF-16">UTF-16</a>
format.</p>
<p><em>Semantic note:</em> Technically, some Unicode characters are represented by
<em>two</em> 16-bit code units, collectively known as a \"surrogate pair.\"
Similarly, some <a href="https://learn.microsoft.com/windows/win32/intl/code-pages">ANSI code
pages</a>
(commonly known as <a href="https://learn.microsoft.com/windows/win32/intl/double-byte-character-sets">Double Byte Character
Sets</a>)
contain some double-byte characters. However, for practical reasons
these are almost always treated as two individual units (referred to as
\"characters\" for simplicity).</p>
<h3 id="Buffer">Buffer</h3>
<p>When allocating a <a href="lib/Buffer.htm">Buffer</a>, take care to calculate the
correct number of <em>bytes</em> for whichever encoding is required. For
example:</p>
<pre class="codehilite"><code>ansi_buf  := Buffer(capacity_in_chars)
utf16_buf := Buffer(capacity_in_chars * 2)
</code></pre>

<p>If an ANSI or UTF-8 string will be written into the buffer with
<a href="lib/StrPut.htm">StrPut</a>, do not use <a href="lib/StrLen.htm">StrLen</a> to
determine the buffer size, as the ANSI or UTF-8 length may differ from
the native (UTF-16) length. Instead, use
<a href="lib/StrPut.htm#ExEncoding">StrPut</a> to calculate the required buffer
size. For example:</p>
<pre class="codehilite"><code>required_bytes := StrPut(source_string, &quot;cp0&quot;)
ansi_buf := Buffer(required_bytes)
StrPut(source_string, ansi_buf)
</code></pre>

<h3 id="DllCall">DllCall</h3>
<p>When the \"Str\" type is used, it means a string in the native format of
the current build. Since some functions may require or return strings in
a particular format, the following string types are available:</p>
<p>Char Size   C / Win32 Types                       Encoding</p>
<hr />
<p>WStr   16-bit      wchar_t*, WCHAR*, LPWSTR, LPCWSTR   UTF-16
  AStr   8-bit       char*, CHAR*, LPSTR, LPCSTR         ANSI (the system default ANSI code page)
  Str    --         TCHAR*, LPTSTR, LPCTSTR              Equivalent to <strong>WStr</strong> in AutoHotkey v2.</p>
<p>If \"Str\" or \"WStr\" is used for a parameter, the address of the
string is passed to the function. For \"AStr\", a temporary ANSI copy of
the string is created and its address is passed instead. As a general
rule, \"AStr\" should not be used for an output parameter since the
buffer is only large enough to hold the input string.</p>
<p><strong>Note:</strong> \"AStr\" and \"WStr\" are equally valid for parameters and the
function\'s return value.</p>
<p>In general, if a script calls a function via DllCall which accepts a
string as a parameter, one or more of the following approaches must be
taken:</p>
<ol>
<li>
<p>If both Unicode (W) and ANSI (A) versions of the function are
    available, omit the W or A suffix and use the \"Str\" type for input
    parameters or the return value. For example, the DeleteFile function
    is exported from kernel32.dll as <code>DeleteFileA</code> and <code>DeleteFileW</code>.
    Since <code>DeleteFile</code> itself doesn\'t really exist, DllCall
    automatically tries <code>DeleteFileW</code>:</p>
<pre class="codehilite"><code>DllCall(&quot;DeleteFile&quot;, &quot;Ptr&quot;, StrPtr(filename))
DllCall(&quot;DeleteFile&quot;, &quot;Str&quot;, filename)
</code></pre>

<p>In both cases, the address of the original unmodified string is
passed to the function.</p>
<p>In some cases this approach may backfire, as DllCall adds the W
suffix only if no function could be found with the original name.
For example, shell32.dll exports ExtractIconExW, ExtractIconExA and
ExtractIconEx with no suffix, with the last two being equivalent. In
that case, omitting the W suffix causes the ANSI version to be
called.</p>
</li>
<li>
<p>If the function accepts a specific type of string as input, the
    script may use the appropriate string type:</p>
<pre class="codehilite"><code>DllCall(&quot;DeleteFileA&quot;, &quot;AStr&quot;, filename)
DllCall(&quot;DeleteFileW&quot;, &quot;WStr&quot;, filename)
</code></pre>

</li>
<li>
<p>If the function has a string parameter used for output, the script
    must allocate a buffer as described <a href="#Buffer">above</a> and pass it to
    the function. If the parameter accepts input, the script must also
    convert the input string to the appropriate format;
    <a href="lib/StrPut.htm">StrPut</a> can be used for this.</p>
</li>
</ol>
<h3 id="NumPutGet">NumPut / NumGet</h3>
<p>When NumPut or NumGet are used with strings, the offset and type must be
correct for the given type of string. The following may be used as a
guide:</p>
<pre class="codehilite"><code>;  8-bit/ANSI   strings:  size_of_char=1  type_of_char=&quot;UChar&quot;
; 16-bit/UTF-16 strings:  size_of_char=2  type_of_char=&quot;UShort&quot;
nth_char := NumGet(buffer_or_address, (n-1)*size_of_char, type_of_char)
NumPut(type_of_char, nth_char, buffer_or_address, (n-1)*size_of_char)
</code></pre>

<p>For the first character, <em>n</em> should have the value 1.</p>
<h2 id="ptr">Pointer Size</h2>
<p>Pointers are 4 bytes in 32-bit builds and 8 bytes in 64-bit builds.
Scripts using structures or DllCalls may need to account for this to run
correctly on both platforms. Specific areas which are affected include:</p>
<ul>
<li>Offset calculation for fields in structures which contain one or
    more pointers.</li>
<li>Size calculation for structures containing one or more pointers.</li>
<li>Type names used with <a href="lib/DllCall.htm">DllCall</a>,
    <a href="lib/NumPut.htm">NumPut</a> or <a href="lib/NumGet.htm">NumGet</a>.</li>
</ul>
<p>For size and offset calculations, use
<a href="Variables.htm#PtrSize">A_PtrSize</a>. For DllCall, NumPut and NumGet, use
the <a href="lib/DllCall.htm">Ptr</a> type where appropriate.</p>
<p>Remember that the offset of a field is usually the total size of all
fields preceding it. Also note that handles (including types like HWND
and HBITMAP) are essentially pointer-types.</p>
<pre class="codehilite"><code>/*
  typedef struct _PROCESS_INFORMATION {
    HANDLE hProcess;    // Ptr
    HANDLE hThread;
    DWORD  dwProcessId; // UInt (4 bytes)
    DWORD  dwThreadId;
  } PROCESS_INFORMATION, *LPPROCESS_INFORMATION;
*/
pi := Buffer(A_PtrSize*2 + 8) ; Ptr + Ptr + UInt + UInt
DllCall(&quot;CreateProcess&quot;, &lt;omitted for brevity&gt;, &quot;Ptr&quot;, &amp;pi, &lt;omitted&gt;)
hProcess    := NumGet(pi, 0)         ; Defaults to &quot;Ptr&quot;.
hThread     := NumGet(pi, A_PtrSize) ;
dwProcessId := NumGet(pi, A_PtrSize*2,     &quot;UInt&quot;)
dwProcessId := NumGet(pi, A_PtrSize*2 + 4, &quot;UInt&quot;)
</code></pre>

<p>\
\
\
\
\
\
\
\
\
\
\
\
\
\
\</p>
                </article>

                <!-- Footer Navigation -->
                <div class="doc-pagination">
                    
                    
                </div>

                <!-- Edit on GitHub -->
                <div class="edit-page">
                    <a href="https://github.com/012090120901209/AHKv2_Docs/edit/main/Compat.md" target="_blank" rel="noopener">
                        <i class="fas fa-edit"></i> Edit this page
                    </a>
                </div>
            </div>

            <!-- Table of Contents -->
            <aside class="toc">
                <div class="toc-wrapper">
                    <h3 class="toc-title">On this page</h3>
                    <nav id="tableOfContents">
                        <div class="toc">
<ul>
<li><a href="#binary-compatibility">Binary Compatibility</a><ul>
<li><a href="#Format">Unicode vs ANSI</a><ul>
<li><a href="#Buffer">Buffer</a></li>
<li><a href="#DllCall">DllCall</a></li>
<li><a href="#NumPutGet">NumPut / NumGet</a></li>
</ul>
</li>
<li><a href="#ptr">Pointer Size</a></li>
</ul>
</li>
</ul>
</div>

                    </nav>
                </div>
            </aside>
        </main>
    </div>

    <!-- Scripts -->
    <script src="/js/theme.js"></script>
    <script src="/js/sidebar.js"></script>
    <script src="/js/search.js"></script>
    <script src="/js/toc.js"></script>
    <script src="/js/syntax.js"></script>
</body>
</html>