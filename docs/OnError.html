<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OnError | AutoHotkey v2 Documentation</title>
    <meta name="description" content="Registers a [function](../Functions.htm) to be called automatically">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="/AHKv2_Docs/css/styles.css">
    <link rel="stylesheet" href="/AHKv2_Docs/css/sidebar.css">
    <link rel="stylesheet" href="/AHKv2_Docs/css/markdown.css">
    <link rel="stylesheet" href="/AHKv2_Docs/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-left">
                <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
                    <i class="fas fa-bars"></i>
                </button>
                <a href="/AHKv2_Docs/" class="navbar-brand">
                    <span class="logo-icon">âš¡</span>
                    <span class="logo-text">AutoHotkey v2</span>
                </a>
            </div>
            <div class="navbar-center">
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="searchInput" placeholder="Search documentation..." autocomplete="off">
                    <kbd class="search-hint">Ctrl+K</kbd>
                </div>
            </div>
            <div class="navbar-right">
                <a href="https://github.com/012090120901209/AHKv2_Docs" class="nav-link" target="_blank" rel="noopener">
                    <i class="fab fa-github"></i>
                    <span>GitHub</span>
                </a>
                <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Search Results Dropdown -->
    <div class="search-results" id="searchResults" style="display: none;"></div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-content">
                <!-- Category Navigation -->
                <div class="sidebar-section">
                    <div class="sidebar-category">
                        <div class="category-header">
                            <i class="fas fa-book"></i>
                            <span>Getting Started</span>
                        </div>
                        <ul class="category-items">
                            <li><a href="/AHKv2_Docs/Tutorial.html">Tutorial</a></li>
                            <li><a href="/AHKv2_Docs/FAQ.html">FAQ</a></li>
                            <li><a href="/AHKv2_Docs/Concepts.html">Concepts</a></li>
                        </ul>
                    </div>

                    <div class="sidebar-category">
                        <div class="category-header">
                            <i class="fas fa-code"></i>
                            <span>Functions</span>
                        </div>
                        <ul class="category-items">
                            <li><a href="/AHKv2_Docs/Functions.html">Functions</a></li>
                            <li><a href="/AHKv2_Docs/StrLen.html">String Functions</a></li>
                            <li><a href="/AHKv2_Docs/WinActivate.html">Window Functions</a></li>
                            <li><a href="/AHKv2_Docs/FileRead.html">File Operations</a></li>
                        </ul>
                    </div>

                    <div class="sidebar-category">
                        <div class="category-header">
                            <i class="fas fa-cube"></i>
                            <span>Objects</span>
                        </div>
                        <ul class="category-items">
                            <li><a href="/AHKv2_Docs/Array.html">Array</a></li>
                            <li><a href="/AHKv2_Docs/Map.html">Map</a></li>
                            <li><a href="/AHKv2_Docs/Object.html">Object</a></li>
                            <li><a href="/AHKv2_Docs/Gui.html">Gui</a></li>
                        </ul>
                    </div>

                    <div class="sidebar-category">
                        <div class="category-header">
                            <i class="fas fa-hashtag"></i>
                            <span>Directives</span>
                        </div>
                        <ul class="category-items">
                            <li><a href="/AHKv2_Docs/_Include.html">#Include</a></li>
                            <li><a href="/AHKv2_Docs/_Requires.html">#Requires</a></li>
                            <li><a href="/AHKv2_Docs/_HotIf.html">#HotIf</a></li>
                        </ul>
                    </div>

                    <div class="sidebar-category">
                        <div class="category-header">
                            <i class="fas fa-info-circle"></i>
                            <span>Reference</span>
                        </div>
                        <ul class="category-items">
                            <li><a href="/AHKv2_Docs/KeyList.html">Key List</a></li>
                            <li><a href="/AHKv2_Docs/Hotkeys.html">Hotkeys</a></li>
                            <li><a href="/AHKv2_Docs/Variables.html">Variables</a></li>
                            <li><a href="/AHKv2_Docs/Language.html">Language</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="content">
            <div class="content-wrapper">
                <!-- Breadcrumb -->
                <nav class="breadcrumb" aria-label="Breadcrumb">
                    <a href="/AHKv2_Docs/">Home</a> <i class="fas fa-chevron-right"></i> <span>OnError</span>
                </nav>

                <!-- Document Content -->
                <article class="markdown-body">
                    <h1 id="onerror">OnError</h1>
<p>Registers a <a href="../Functions.htm">function</a> to be called automatically
whenever an unhandled error occurs.</p>
<pre class="codehilite"><code class="language-Syntax">OnError Callback , AddRemove
</code></pre>

<h2 id="Parameters">Parameters</h2>
<dl>
<dt>Callback</dt>
<dd>
<p>Type: <a href="../misc/Functor.htm">Function Object</a></p>
<p>The function to call.</p>
<p>The callback accepts two parameters and can be
<a href="../Functions.htm#intro">defined</a> as follows:</p>
<p><code>NoIndent
MyCallback(Thrown, Mode) { ...</code></p>
<p>Although the names you give the parameters do not matter, the
following values are sequentially assigned to them:</p>
<ol>
<li>The thrown value, usually an <a href="Error.htm">Error object</a>.</li>
<li>The error mode: Return, Exit, or ExitApp. For details, see the
    <a href="#Error_Modes">table below</a>.</li>
</ol>
<p>You can omit one or more parameters from the end of the callback\'s
parameter list if the corresponding information is not needed, but
in this case an asterisk must be specified as the final parameter,
e.g. <code>MyCallback(Param1, *)</code>.</p>
<p>The callback can return one of the following values (other values
are reserved for future use and should be avoided):</p>
<ul>
<li><code>0</code>, <code>""</code> or no Return: Allow error handling to proceed as
    normal.</li>
<li><code>1</code>: Suppress the default error dialog and any remaining error
    callbacks.</li>
<li><code>-1</code>: As above, but if <em>Mode</em> (the second parameter) contains
    the word Return, execution of the current thread is permitted to
    continue.</li>
</ul>
</dd>
<dt>AddRemove</dt>
<dd>
<p>Type: <a href="../Concepts.htm#numbers">Integer</a></p>
<p>If omitted, it defaults to 1. Otherwise, specify one of the
following numbers:</p>
<ul>
<li>1 = Call the callback after any previously registered callbacks.</li>
<li>-1 = Call the callback before any previously registered
    callbacks.</li>
<li>0 = Do not call the callback.</li>
</ul>
</dd>
</dl>
<h2 id="Error_Modes">Error Modes</h2>
<p>Mode      Description</p>
<hr />
<p>Return    The thrown value is a continuable runtime error. The thread continues if the callback returns -1; otherwise the thread exits.
  Exit      The thrown value is a non-continuable runtime error or a value <a href="Throw.htm">thrown</a> by the script. The thread will exit.
  ExitApp   The thrown value is a critical runtime error, such as corruption detected by DllCall. The program will exit.</p>
<h2 id="Remarks">Remarks</h2>
<p><em>Callback</em> is called only for errors or exceptions which would normally
cause an error message to be displayed. It cannot be called for a
load-time error, since OnError cannot be called until after the script
has loaded.</p>
<p><em>Callback</em> is called on the current <a href="../misc/Threads.htm">thread</a>,
before it exits (that is, before the call stack unwinds).</p>
<h2 id="Related">Related</h2>
<p><a href="Try.htm">Try</a>, <a href="Catch.htm">Catch</a>, <a href="Throw.htm">Throw</a>,
<a href="OnExit.htm">OnExit</a></p>
<h2 id="Examples">Examples</h2>
<p>::: {#ExBasic .ex}
<a class="ex_number" href="#ExBasic"></a> Logs errors caused by the script into a text
file instead of displaying them to the user.</p>
<pre class="codehilite"><code>OnError LogError
i := Integer(&quot;cause_error&quot;)

LogError(exception, mode) {
    FileAppend &quot;Error on line &quot; exception.Line &quot;: &quot; exception.Message &quot;`n&quot;
        , &quot;errorlog.txt&quot;
    return true
}
</code></pre>

<p>:::</p>
<p>::: {#ExAccumulator .ex}
<a class="ex_number" href="#ExAccumulator"></a> Use OnError to implement alternative
error handling methods. Caveat: OnError is ineffective while
<a href="Try.htm">Try</a> is active.</p>
<pre class="codehilite"><code>AccumulateErrors()
{
    local ea := ErrorAccumulator()
    ea.Start()
    return ea
}

class ErrorAccumulator
{
    Errors := []                        ; Array for accumulated errors.
    _cb := AccumulateError.Bind(this.Errors)
    Start() =&gt; OnError(this._cb, -1)    ; Register our cb before others.
    Stop() =&gt; OnError(this._cb, 0)      ; Unregister our cb.
    Last =&gt; this.Errors[-1]             ; Most recent error.
    Count =&gt; this.Errors.Length         ; Number of accumulated errors.
    __item[i] =&gt; this.Errors[i]         ; Shortcut for indexing.
    __delete() =&gt; this.Stop()           ; For tying to function scope.
}

; This is the OnError callback. 'errors' is given a value via Bind().
AccumulateError(errors, e, mode)
{
    if mode != &quot;Return&quot; ; Not continuable.
        return
    if e.What = &quot;&quot; ; Expression defect or similar, not a built-in function.
        return
    try {
        ; Try to print the error to stdout.
        FileAppend Format(&quot;{1} ({2}) : ({3}) {4}`n&quot;, e.File, e.Line, e.What, e.Message), &quot;*&quot;
        if HasProp(e, &quot;extra&quot;)
            FileAppend &quot;     Specifically: &quot; e.Extra &quot;`n&quot;, &quot;*&quot;
    }
    errors.Push(e)
    return -1 ; Continue.
}

RearrangeWindows()
{
    ; Start accumulating errors in 'err'.
    local err := AccumulateErrors()

    ; Do some things that might fail...
    MonitorGetWorkArea , &amp;left, &amp;top, &amp;right, &amp;bottom
    width := (right-left)//2, height := bottom-top
    WinMove left, top, width, height, A_ScriptFullPath
    WinMove left+width, top, width, height, &quot;AutoHotkey v2 Help&quot;

    ; Check if any errors occurred.
    if err.Count
        MsgBox err.Count &quot; error(s); last error at line #&quot; err.Last.Line
    else
        MsgBox &quot;No errors&quot;

    ; Stop is called automatically when the variable goes out of scope,
    ; since only we have a reference to the object.  This causes OnError
    ; to be called to unregister the callback.
    ;err.Stop()
}

; Call the test function which suppresses and accumulates errors.
RearrangeWindows()
; Call another function to show normal error behaviour is restored.
WinMove 0, 0, 0, 0, &quot;non-existent window&quot;
</code></pre>

<p>:::</p>
                </article>

                <!-- Footer Navigation -->
                <div class="doc-pagination">
                    
                    
                </div>

                <!-- Edit on GitHub -->
                <div class="edit-page">
                    <a href="https://github.com/012090120901209/AHKv2_Docs/edit/main/OnError.md" target="_blank" rel="noopener">
                        <i class="fas fa-edit"></i> Edit this page
                    </a>
                </div>
            </div>

            <!-- Table of Contents -->
            <aside class="toc">
                <div class="toc-wrapper">
                    <h3 class="toc-title">On this page</h3>
                    <nav id="tableOfContents">
                        <div class="toc">
<ul>
<li><a href="#onerror">OnError</a><ul>
<li><a href="#Parameters">Parameters</a></li>
<li><a href="#Error_Modes">Error Modes</a></li>
<li><a href="#Remarks">Remarks</a></li>
<li><a href="#Related">Related</a></li>
<li><a href="#Examples">Examples</a></li>
</ul>
</li>
</ul>
</div>

                    </nav>
                </div>
            </aside>
        </main>
    </div>

    <!-- Scripts -->
    <script>
        // Set base URL for JavaScript modules
        window.BASE_URL = '/AHKv2_Docs';
    </script>
    <script src="/AHKv2_Docs/js/theme.js"></script>
    <script src="/AHKv2_Docs/js/sidebar.js"></script>
    <script src="/AHKv2_Docs/js/search.js"></script>
    <script src="/AHKv2_Docs/js/toc.js"></script>
    <script src="/AHKv2_Docs/js/syntax.js"></script>
</body>
</html>